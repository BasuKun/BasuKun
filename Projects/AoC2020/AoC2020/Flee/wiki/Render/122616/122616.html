<div class="wikidoc"><b>On-demand Variables</b><br /><br />Flee expressions support variables whose type and value come from events.  If an expression references a variable that doesn&#39;t exist in the expression&#39;s VariableCollection, Flee will raise the ResolveVariableType event.  If the event is handled and a type is specified, Flee will then raise the ResolveVariableValue event every time the expression is evaluated.  In that event, you have access to the variable&#39;s name and type and it is up to you to provide a compatible value.<br /><br />Here&#39;s an example that ask the user to input an expression and then uses on-demand variables to ask the user for the value of each variable in their expression:<br /><br /><pre>
static void Main()
{
   ExpressionContext context = new ExpressionContext();
   VariableCollection variables = context.Variables;

   // Hook up the required events
   variables.ResolveVariableType += new EventHandler&lt;ResolveVariableTypeEventArgs&gt;(variables_ResolveVariableType);
   variables.ResolveVariableValue += new EventHandler&lt;ResolveVariableValueEventArgs&gt;(variables_ResolveVariableValue);

   // Get an expression from the user
   Console.Write(&quot;Enter an expression: &quot;);
   string s = Console.ReadLine();
   
   // Compile the expression; Flee will query for the types of any variables
   IDynamicExpression e = context.CompileDynamic(s);

   // Evaluate the expression; Flee will query for the values of each variable
   object result = e.Evaluate();
   Console.WriteLine(&quot;The result is: {0}&quot;, result);
}

// Called when Flee needs to know the type of a variable
static void variables_ResolveVariableType(object sender, ResolveVariableTypeEventArgs e)
{
   // Make all variables Doubles
   e.VariableType = typeof(double);
}

// Called when Flee needs the value of a variable
static void variables_ResolveVariableValue(object sender, ResolveVariableValueEventArgs e)
{
   Console.Write(&quot;Enter value for variable &#39;{0}&#39; ({1}): &quot;, e.VariableName, e.VariableType.Name);
   string value = Console.ReadLine();
   e.VariableValue = Convert.ChangeType(value, e.VariableType);
}
</pre><br /><br />Note that Flee raises the resolve events once for every occurence of a variable in an expression.  This means an expression like <span class="codeInline">a + (a * 0.15)</span>, will raise both events twice.<br /><br /><b>Another example</b><br />This sample <a href=".\f4471249-73b4-4eed-b652-3fc99ecb02b4">project</a> shows how to use Flee and on-demand variables to compute an expression for each row of a data table where the expression can reference the columns in the current row.</div><div class="ClearBoth"></div>